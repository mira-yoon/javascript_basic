
/*

async & awaitëŠ” Promiseë¥¼ ì¢€ ë” ê°„ê²°í•˜ê³  ê°„í¸í•˜ê³ , ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ê²ƒ ì²˜ëŸ¼ ë³´ì´ê²Œ ë§Œë“¤ì–´ì¤€ë‹¤. 
async & awaitì€ ìƒˆë¡œìš´ ê²ƒì´ ì¶”ê°€ëœ ê²ƒì´ ì•„ë‹ˆë¼ ê¸°ì¡´ì— ì¡´ì¬í•˜ëŠ” Promise ìœ„ì— ì¡°ê¸ˆ ë” ê°„í¸í•œ APIë¥¼ ì œê³µí•œë‹¤. 
async & awaitì€ syntactical sugarì´ë‹¤. 
(syntactical sugar : ê¸°ì¡´ì— ì¡´ì¬í•˜ëŠ” ê²ƒ ìœ„ì— ë˜ëŠ” ê¸°ì¡´ì— ì¡´ì¬í•˜ëŠ” ê²ƒì„ ê°ì‹¸ì„œ ê°„í¸í•˜ê²Œ ì“¸ ìˆ˜ ìˆëŠ” APIë¥¼ ì œê³µí•˜ëŠ” ê²ƒ)



********************************************* 1. async *********************************************


ì‚¬ìš©ìì˜ ë°ì´í„°ë¥¼ ë°±ì—”ë“œì—ì„œ ë°›ì•„ì˜¤ëŠ”ë° 10ì´ˆ ê±¸ë¦¬ëŠ” í•¨ìˆ˜ê°€ ìˆë‹¤ê³  ê°€ì •í•´ ë³´ì. 
10ì´ˆê°€ ì§€ë‚˜ë©´ ì‚¬ìš©ì ì´ë¦„ì¸ 'ellie'ë¥¼ ë¦¬í„´í•œë‹¤. 

---------------------------------------------------------
  function fetchUser() {
    // do network reqeust in 10 secs....
    return 'ellie';
  }

  const user = fetchUser();
  console.log(user);
---------------------------------------------------------

fetchUser() ê°€ í˜¸ì¶œë˜ì—ˆë„¤? 
-> í•¨ìˆ˜ê°€ ì„ ì–¸ëœ ê³³ìœ¼ë¡œ ê°€ì„œ í•¨ìˆ˜ì˜ ì½”ë“œë¸”ëŸ­ {} ì„ ì‹¤í–‰í•œë‹¤. 
-> 10ì´ˆê°€ ê±¸ë¦¬ê¸° ë•Œë¬¸ì— 10ì´ˆ ë™ì•ˆ ë¨¸ë¬´ë¥´ê³  ìˆë‹¤ê°€ 
-> 10ì´ˆê°€ ì§€ë‚˜ì„œ ì„±ê³µì ìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ê²Œ ë˜ë©´ 
-> ê·¸ì œì„œì•¼ ë‹¤ìŒì¤„ë¡œ ë„˜ì–´ê°€ì„œ 'ellie'ë¥¼ ë¦¬í„´í•œë‹¤. 
-> 'ellie'ê°€ const userì— í• ë‹¹ì´ ë˜ê³  ë‹¤ìŒì¤„ë¡œ ë„˜ì–´ê°€ì„œ 
-> console.log(user);ê°€ ì‹¤í–‰ë˜ì„œ ì½˜ì†”ì°½ì— ì¶œë ¥ëœë‹¤. 


ì´ë ‡ê²Œ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì½”ë“œì— ë¹„ë™ê¸°ì ì¸ ì²˜ë¦¬ë¥¼ ì „í˜€ í•˜ì§€ ì•Šìœ¼ë©´
ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„ì€ ë™ê¸°ì ìœ¼ë¡œ ì½”ë“œë¥¼ ìˆ˜í–‰í•œë‹¤. 
(ë‹¤ìŒ ì¤„ë¡œ ë„˜ì–´ê°€ì§€ ì•Šê³  10ì´ˆ ê±¸ë¦¬ëŠ” ì‘ì—…ì—ì„œ 10ì´ˆê°„ ë¨¸ë¬´ë¥´ê²Œ ëœë‹¤. 
ë§Œì•½ ì´ ì½”ë“œ ë’¤ì— UIë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì½”ë“œê°€ ìˆë‹¤ë©´ 10ì´ˆ ë™ì•ˆ í™”ë©´ì— UIê°€ ë‚˜ì˜¤ì§€ ì•Šê²Œ ë˜ëŠ” ê²ƒì´ë‹¤.)


Promiseë¥¼ ì´ìš©í•´ì„œ ë¹„ë™ê¸°ì ì¸ ì²˜ë¦¬ë¥¼ í•˜ë©´ ì´ë ‡ê²Œ í•œë‹¤. 

---------------------------------------------------------
  function fetchUser() {
    return new Promise((resolve, reject)=>{
      // do network reqeust in 10 secs....
      resolve('ellie');
    })
  }

  const user = fetchUser();
  user.then( (name)=> {console.log(name)} );
  console.log(user);
---------------------------------------------------------

ì–¸ì œ ìœ ì €ì˜ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¬ì§„ ëª¨ë¥´ê² ì§€ë§Œ ì•½ì†í• ê»˜. 
Promise ë¼ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ê°–ê³  ìˆìœ¼ë©´, ì—¬ê¸°ì— ë„¤ê°€ then() ì´ë¼ëŠ” ì½œë°±í•¨ìˆ˜ë§Œ ë“±ë¡í•´ ë†“ìœ¼ë©´ 
ìœ ì €ì˜ ë°ì´í„°ê°€ ì¤€ë¹„ë˜ëŠ” ëŒ€ë¡œ ë„¤ê°€ ë“±ë¡í•œ ì½œë°±í•¨ìˆ˜(Promiseê°€ ì „ë‹¬í•˜ëŠ” ì½œë°±í•¨ìˆ˜ executor)ë¥¼ ë¶ˆëŸ¬ì¤„ê»˜. 

*/


// async í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ë©´ {}ì½”ë“œë¸”ëŸ­ ì•ˆì— ìˆëŠ” ì½”ë“œë“¤ì´ ìë™ì ìœ¼ë¡œ Promiseë¡œ ë³€í™˜ëœë‹¤. 
async function fetchUser() {
  // do network reqeust in 10 secs....
  return 'ellie';
}

const user = fetchUser();
user.then(console.log);
console.log(user); // ì½˜ì†”ì°½ì—ì„œ userê°€ Promiseë¥¼ ë¦¬í„´í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. 





/********************************************* 2. await âœ¨ *********************************************/

// await í‚¤ì›Œë“œëŠ” asyncê°€ ë¶™ì€ í•¨ìˆ˜ ì•ˆì—ì„œë§Œ ì“¸ ìˆ˜ ìˆë‹¤.

function delay(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

/*
< asyncì™€ await í‚¤ì›Œë“œë¥¼ ì“°ì§€ ì•ŠëŠ” ë°©ì‹ >

function getApple() {
  return delay(3000)
  .then(()=>'ğŸ');
}
*/

async function getApple() {
  await delay(2000); // delay()ê°€ ëë‚  ë•Œ ê¹Œì§€ ê¸°ë‹¤ë ¤ë¼ 
  return 'ğŸ'; // 2ì´ˆ í›„ì— ì‚¬ê³¼ë¥¼ ë¦¬í„´í•œë‹¤. 
}

async function getBanana() {
  await delay(1000); // delay()ê°€ ëë‚  ë•Œ ê¹Œì§€ ê¸°ë‹¤ë ¤ë¼ 
  return 'ğŸŒ'; // 1ì´ˆ í›„ì— ë°”ë‚˜ë‚˜ë¥¼ ë¦¬í„´í•œë‹¤. 
}

/*

========== asyncê³¼ await í‚¤ì›Œë“œë¥¼ ì“°ì§€ ì•Šê³  Promise chainingì„ ì´ìš©í•œ ë°©ì‹ ==========


function pickFruits() {
  return getApple().then(apple =>{
    return getBanana().then(banana => `${apple} + ${banana}`);
  })
}

pickFruits().then(console.log); // 3ì´ˆ í›„ì— ì½˜ì†”ì°½ì— ğŸ + ğŸŒê°€ ì°íŒë‹¤. 



- ê·¸ëŸ°ë° Promiseë„ ì¤‘ì²©ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ ì½œë°±ì§€ì˜¥ê³¼ ë¹„ìŠ·í•œ ë¬¸ì œì ì´ ë°œìƒí•œë‹¤. 


======================== asyncê³¼ await í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•œ ë°©ì‹ ========================

- awaitì€ í”„ë¡œë¯¸ìŠ¤ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ê°€ ë‚˜ê³  ë©ˆì¶˜ë‹¤. 
- ê·¸ëŸ¬ë¯€ë¡œ try {} catch {} êµ¬ë¬¸ì„ ì‚¬ìš©í•œë‹¤.

async function pickFruits() {
  try{ 
    const apple = await getApple();
    const banana = await getBanana();
  } catch {
    console.log("error!");
  }
  
  return `${apple} + ${banana}`;
}

pickFruits().then(console.log); // 3ì´ˆ í›„ì— ì½˜ì†”ì°½ì— ğŸ + ğŸŒê°€ ì°íŒë‹¤. 


ê·¸ëŸ°ë° ì´ ë°©ì‹ì—ë„ ë¬¸ì œê°€ ìˆë‹¤. 
ì´ë ‡ê²Œ í•˜ë©´ ì‚¬ê³¼ë¥¼ ë°›ëŠ”ë°ì— 2ì´ˆê°€ ì§€ë‚˜ê³ , ë°”ë‚˜ë‚˜ë¥¼ ë°›ëŠ”ë°ì— ë˜ ë‹¤ì‹œ 1ì´ˆê°€ ì§€ë‚œë‹¤. 
ì´ë ‡ê²Œ ìˆœì°¨ì ìœ¼ë¡œ ì§„í–‰í•˜ê²Œ ë˜ë©´ ë¹„íš¨ìœ¨ì ì´ ë  ìˆ˜ ìˆë‹¤. 
ì‚¬ê³¼ë¥¼ ë°›ëŠ” ê²ƒê³¼ ë°”ë‚˜ë‚˜ë¥¼ ë°›ëŠ” ê²ƒì€ ì„œë¡œ ì—°ê´€ì´ ì—†ê¸° ë•Œë¬¸ì— ê¸°ë‹¤ë¦´ í•„ìš”ê°€ ì—†ë‹¤. 

*/


/************** await ë³‘ë ¬ì²˜ë¦¬  **************/

async function pickFruits() {
  const applePromise = getApple(); // ì´ë ‡ê²Œ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë§Œë“œëŠ” ìˆœê°„ í”„ë¡œë¯¸ìŠ¤ ì•ˆì— ìˆëŠ” ì½”ë“œë¸”ëŸ­ì´ ì‹¤í–‰ëœë‹¤. 
  const bananaPromise = getBanana();
  const apple = await applePromise;
  const banana = await bananaPromise;
  return `${apple} + ${banana}`;
}

pickFruits().then(console.log); // 2ì´ˆ í›„ì— ì½˜ì†”ì°½ì— ğŸ + ğŸŒê°€ ì°íŒë‹¤. 


/*
ì‚¬ê³¼ì™€ ë°”ë‚˜ë‚˜ë¥¼ ë³‘ë ¬ì ìœ¼ë¡œ ë™ì‹œì— ë°›ì•„ì™”ê¸° ë•Œë¬¸ì— 2ì´ˆê°€ ê±¸ë¦° ê²ƒì´ë‹¤. 

ê·¸ëŸ°ë° ì‚¬ê³¼ë¥¼ ë°›ëŠ” ê²ƒê³¼ ë°”ë‚˜ë‚˜ë¥¼ ë°›ëŠ” ê²ƒì€ ì„œë¡œ ì—°ê´€ì´ ì—†ë‹¤. 
ì´ë ‡ê²Œ ë³‘ë ¬ì ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•œ ê²½ìš°ì—ëŠ” 
ìœ„ì™€ ê°™ì´ ì½”ë“œë¥¼ ì‘ì„±í•˜ì§€ ì•Šê³ , Promiseì—ì„œ ì œê³µí•œ APIë¥¼ ì´ìš©í•œë‹¤. 
*/




/********************************************* 3. useful APIs âœ¨ *********************************************/

/*
Promise.all(Promise ë°°ì—´);

Promiseì— ìˆëŠ” all()ì´ë¼ëŠ” APIì— Promise ë°°ì—´ì„ ì „ë‹¬í•˜ê²Œ ë˜ë©´ 
ëª¨ë“  Promiseë“¤ì´ ë³‘ë ¬ì ìœ¼ë¡œ ë‹¤ ë°›ì•„ì§ˆ ë•Œê¹Œì§€ ëª¨ì•„ì£¼ëŠ” ì—­í• ì„ í•œë‹¤. 
*/


// all()ì„ ì“°ë©´ ë¬´ì—‡ì„ ë¦¬í„´í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸
function testPickAllFruits() {
  return Promise.all([getApple(), getBanana()]);
}
testPickAllFruits().then((fruits) => console.log(fruits)); // 2ì´ˆ í›„ì— ì½˜ì†”ì°½ì— ['ğŸ', 'ğŸŒ'] ê°€ ì°íŒë‹¤. 


// join() ìœ¼ë¡œ ìŠ¤íŠ¸ë§ìœ¼ë¡œ ë°”ê¿”ì„œ ë¦¬í„´
function pickAllFruits() {
  return Promise.all([getApple(), getBanana()]).then(fruits =>
    fruits.join(' + ')
  );
}
pickAllFruits().then(console.log); // 2ì´ˆ í›„ì— ì½˜ì†”ì°½ì— ğŸ + ğŸŒ ê°€ ì°íŒë‹¤. 


/*
Promise.race(Promise ë°°ì—´);
ë¬´ì—‡ì´ë“  ìƒê´€ ì—†ê³  ë¨¼ì € ë°›ì•„ì§€ëŠ” ì²« ë²ˆì§¸ ê³¼ì¼ë§Œ ë°›ì•„ì˜¤ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•œë‹¤. 
*/

function pickOnlyOne() {
  return Promise.race([getApple(), getBanana()]);
}

pickOnlyOne().then(console.log); // 1ì´ˆ í›„ì— ì½˜ì†”ì°½ì— ğŸŒê°€ ì°íŒë‹¤. 


